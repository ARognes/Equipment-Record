import{aq as nt,S as ot,i as st,s as rt,e as P,c as k,a as A,d as D,g as B,o as U,p as at,q as V,n as lt,a6 as H,a7 as j,k as X,w as z,m as Y,x as Z,b,y as F,V as E,a8 as J,B as K,ar as ht,t as ft,h as ct,H as x,as as q,W as ut}from"../../../chunks/vendor-5a111b6e.js";import{G as gt}from"../../../chunks/Gallery-0531e052.js";import"../../../chunks/Loading-423e8b8f.js";/* empty css                                                            */function mt(f){return new Promise(c=>{const o=URL.createObjectURL(f);let r=new Image;r.onload=function(){URL.revokeObjectURL(this.src),c(this)},r.src=o})}function G(f,c,o){return new Promise((r,a)=>{new nt(f,{quality:c,maxWidth:o,maxHeight:o,async success(l){return r(l)},error(l){a(l)}})})}function pt(f){return new Promise(c=>{f.toBlob(c)})}function dt(f){let c,o,r,a,l,e,t;function i(u){f[14](u)}let m={};return f[3]!==void 0&&(m.images=f[3]),r=new gt({props:m}),H.push(()=>j(r,"images",i)),{c(){c=P("input"),o=X(),z(r.$$.fragment),this.h()},l(u){c=k(u,"INPUT",{type:!0,id:!0,accept:!0,capture:!0}),o=Y(u),Z(r.$$.fragment,u),this.h()},h(){b(c,"type","file"),b(c,"id","camera"),b(c,"accept","image/*"),b(c,"capture","application"),c.multiple=!0},m(u,p){B(u,c,p),B(u,o,p),F(r,u,p),l=!0,e||(t=E(c,"change",f[13]),e=!0)},p(u,p){const M={};!a&&p&8&&(a=!0,M.images=u[3],J(()=>a=!1)),r.$set(M)},i(u){l||(V(r.$$.fragment,u),l=!0)},o(u){U(r.$$.fragment,u),l=!1},d(u){u&&D(c),u&&D(o),K(r,u),e=!1,t()}}}function wt(f){let c,o,r,a,l,e,t,i,m,u,p,M,N;function L(g){f[12](g)}let y={min:-180,max:180,float:!0,pips:!0,pipstep:45,all:"label",suffix:"\xBA",springValues:{stiffness:.3,damping:1}};return f[2]!==void 0&&(y.values=f[2]),e=new ht({props:y}),H.push(()=>j(e,"values",L)),{c(){c=P("div"),o=P("canvas"),r=P("canvas"),a=X(),l=P("div"),z(e.$$.fragment),i=X(),m=P("button"),u=ft("Crop"),this.h()},l(g){c=k(g,"DIV",{id:!0,class:!0});var R=A(c);o=k(R,"CANVAS",{width:!0,height:!0,class:!0}),A(o).forEach(D),r=k(R,"CANVAS",{id:!0,width:!0,height:!0,class:!0}),A(r).forEach(D),R.forEach(D),a=Y(g),l=k(g,"DIV",{id:!0,class:!0});var v=A(l);Z(e.$$.fragment,v),i=Y(v),m=k(v,"BUTTON",{});var T=A(m);u=ct(T,"Crop"),T.forEach(D),v.forEach(D),this.h()},h(){b(o,"width",window.innerWidth),b(o,"height",window.innerWidth),b(o,"class","svelte-ezgo01"),b(r,"id","canvas-overlay"),b(r,"width",window.innerWidth),b(r,"height",window.innerWidth),b(r,"class","svelte-ezgo01"),b(c,"id","image-area"),b(c,"class","svelte-ezgo01"),b(l,"id","body"),b(l,"class","svelte-ezgo01")},m(g,R){B(g,c,R),x(c,o),f[10](o),x(c,r),f[11](r),B(g,a,R),B(g,l,R),F(e,l,null),x(l,i),x(l,m),x(m,u),p=!0,M||(N=[E(r,"pointerdown",f[7]),E(r,"pointermove",f[8]),E(r,"pointerup",function(){q(f[5].reset)&&f[5].reset.apply(this,arguments)}),E(r,"pointerout",function(){q(f[5].reset)&&f[5].reset.apply(this,arguments)}),E(r,"pointercancel",function(){q(f[5].reset)&&f[5].reset.apply(this,arguments)}),E(m,"click",f[9])],M=!0)},p(g,R){f=g;const v={};!t&&R&4&&(t=!0,v.values=f[2],J(()=>t=!1)),e.$set(v)},i(g){p||(V(e.$$.fragment,g),p=!0)},o(g){U(e.$$.fragment,g),p=!1},d(g){g&&D(c),f[10](null),f[11](null),g&&D(a),g&&D(l),K(e),M=!1,ut(N)}}}function _t(f){let c,o,r,a;const l=[wt,dt],e=[];function t(i,m){return i[6]>=0?0:1}return o=t(f),r=e[o]=l[o](f),{c(){c=P("div"),r.c()},l(i){c=k(i,"DIV",{});var m=A(c);r.l(m),m.forEach(D)},m(i,m){B(i,c,m),e[o].m(c,null),a=!0},p(i,[m]){let u=o;o=t(i),o===u?e[o].p(i,m):(lt(),U(e[u],1,1,()=>{e[u]=null}),at(),r=e[o],r?r.p(i,m):(r=e[o]=l[o](i),r.c()),V(r,1),r.m(c,null))},i(i){a||(V(r),a=!0)},o(i){U(r),a=!1},d(i){i&&D(c),e[o].d()}}}const bt=.9,vt=1200,yt=.6,Rt=200,S=20;function Dt(f,c,o){let r=[],a,l;const e=S/2,t={top:e,left:e,bottom:0,right:0};let i={upDown:0,leftRight:0,moving:!1,reset:()=>o(5,i={upDown:0,leftRight:0,moving:!1,reset:i.reset})},m={x:0,y:0};const u=(n,h,s)=>n>=h-e&&n<s+e,p=(n,h,s=e)=>Math.abs(h-n)<s;function M(n){if(i.upDown!==0||i.leftRight!==0||i.moving===!0)return;const h=n.x,s=n.y,d=u(h,t.left,t.right),w=u(s,t.top,t.bottom),_=p(s,t.top),C=p(s,t.bottom),O=p(h,t.left),W=p(h,t.right);d&&o(5,i.upDown=+_-+C,i),w&&o(5,i.leftRight=+O-+W,i);let I={upDown:0,leftRight:0};p(s,t.top,e*3)&&(p(h,t.left,e*3)?I={upDown:1,leftRight:1}:p(h,t.right,e*3)&&(I={upDown:1,leftRight:-1})),p(s,t.bottom,e*3)&&(p(h,t.left,e*3)?I={upDown:-1,leftRight:1}:p(h,t.right,e*3)&&(I={upDown:-1,leftRight:-1})),I.upDown!==0&&I.leftRight!==0&&(o(5,i.upDown=I.upDown,i),o(5,i.leftRight=I.leftRight,i)),d&&w&&!i.upDown&&!i.leftRight?o(5,i.moving=!0,i):(i.upDown||i.leftRight)&&(m.x=i.leftRight===1?t.left-h:t.right-h,m.y=i.upDown===1?t.top-s:t.bottom-s),N(n)}function N(n){if(i.upDown===0&&i.leftRight===0&&i.moving===!1)return;const h=n.x+m.x,s=n.y+m.y;if(i.moving){o(5,i.moving=!0,i);let w=n.movementX/window.devicePixelRatio,_=n.movementY/window.devicePixelRatio;t.left+w<e?w-=t.left+w-e:t.right+w>=l.width-e&&(w-=t.right+w-l.width+e),t.top+_<e?_-=t.top+_-e:t.bottom+_>=l.height-e&&(_-=t.bottom+_-l.height+e),t.left+=w,t.right+=w,t.top+=_,t.bottom+=_}else i.upDown==1?t.top=s:i.upDown==-1&&(t.bottom=s),i.leftRight==1?t.left=h:i.leftRight==-1&&(t.right=h);t.top=Math.max(t.top,e),t.bottom=Math.min(t.bottom,l.height-e),t.left=Math.max(t.left,e),t.right=Math.min(t.right,l.width-e);const d=S*2;i.upDown==1?t.top=Math.min(t.top,t.bottom-d):i.upDown==-1&&(t.bottom=Math.max(t.bottom,t.top+d)),i.leftRight==1?t.left=Math.min(t.left,t.right-d):i.leftRight==-1&&(t.right=Math.max(t.right,t.left+d)),L()}function L(){const n=l.getContext("2d");n.clearRect(0,0,l.width,l.height),n.fillStyle="black";const h=Object.values(t);for(let s in h)n.beginPath(),n.rect(+s==3?t.right-e:0,+s==2?t.bottom-e:0,+s==1?t.left+e:l.width+2,+s==0?t.top+e:l.height+2),n.fill();for(let s in h)n.fillStyle="#888",n.beginPath(),n.rect(h[+s%2*2+1]-e,h[Math.floor(+s/2)*2]-e,e*2,e*2),n.fill(),n.fillStyle="black",n.beginPath(),n.rect(h[+s%2*2+1]-e/2,h[Math.floor(+s/2)*2]-e/2,e,e),n.fill(),n.fillStyle="#888",n.beginPath(),n.rect(+s%2==1?+s==1?t.left-e/4:t.right-e/4:(t.left+t.right)/2-e,+s%2==0?+s==0?t.top-e/4:t.bottom-e/4:(t.top+t.bottom)/2-e,+s%2==1?e/2:e*2,+s%2==0?e/2:e*2),n.fill()}let y=null,g=-1;async function R(){if(!y.length||g<0)return console.log("All images done");try{const n=await mt(y[g]);t.right=l.width-e,t.bottom=l.height-e;const h=n.naturalWidth,s=n.naturalHeight;o(0,a.width=o(0,a.height=Math.max(h,s),a),a);const d=a.width/window.innerWidth,w=a.getContext("2d"),_=h>s,C=h-S*d*2,O=s-S*d*2;w.clearRect(0,0,a.width,a.height),w.drawImage(n,_?S*d:a.width/2-h/2+S*d,_?a.width/2-s/2+S*d:S*d,_?C:h/O*s,_?O:s/C*h),L()}catch(n){console.error(n)}}let v=[0];async function T(){const n=document.createElement("canvas");n.width=a.width,n.height=a.height;const h=n.getContext("2d");h.save(),h.translate(a.width/2,a.height/2),h.rotate(v[0]*Math.PI/180),h.clearRect(0,0,n.width,n.height),h.drawImage(a,-a.width/2,-a.width/2),h.restore();const s=document.createElement("canvas"),d=s.getContext("2d"),w=a.width/window.innerWidth;s.width=(t.right-t.left-e*2)*w,s.height=(t.bottom-t.top-e*2)*w;const _=h.getImageData((t.left+e)*w,(t.top+e)*w,s.width,s.height);d.clearRect(0,0,s.width,s.height),d.putImageData(_,0,0),d.restore();const C=await pt(s),O=await G(C,bt,vt);await G(C,yt,Rt);const W=await createImageBitmap(O);s.width=W.width,s.height=W.height,d.drawImage(W,0,0);const I=s.toDataURL();r.push({src:I,done:!0}),o(6,g--,g),R()}function Q(n){H[n?"unshift":"push"](()=>{a=n,o(0,a),o(2,v)})}function $(n){H[n?"unshift":"push"](()=>{l=n,o(4,l)})}function tt(n){v=n,o(2,v)}function et(){y=this.files,o(1,y)}function it(n){r=n,o(3,r)}return f.$$.update=()=>{f.$$.dirty&2&&y!=null&&y.length&&(o(6,g=y.length-1),R()),f.$$.dirty&5&&a!=null&&a.style&&o(0,a.style.transform=`rotate(${v[0]}deg)`,a)},[a,y,v,r,l,i,g,M,N,T,Q,$,tt,et,it]}class Et extends ot{constructor(c){super();st(this,c,Dt,_t,rt,{})}}export{Et as default};
